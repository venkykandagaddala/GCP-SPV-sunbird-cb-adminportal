<div class="container-balanced">
    <div class="page_title_flex">
        <div class="flex margin-left-xl">
            <ws-widget-breadcrumbs-org
                [widgetData]="{titles:[{title:'Events', url:'/app/home/events'},{title:'New event',url:'none'}] }">
            </ws-widget-breadcrumbs-org>
        </div>
        <span class="spacer"></span>
        <div class="flex flex-3 custom button-row-inline margin-top-xs">
            <div>
                <button mat-stroked-button color="accent" type="button" class="mat-accent-border flex-auto-display"
                    (click)="goToList()">
                    <span>Cancel</span>
                </button>
                <button mat-button class="create-btn btn-success" type="button" (click)="onSubmit()"
                    [disabled]="!createEventForm.valid || disableCreateButton">
                    <span>Submit</span>
                </button>
            </div>
            <div *ngIf="displayLoader" class="mt-5 pr-4 flex items-center justify-center">
                <mat-spinner [diameter]="30"></mat-spinner>
            </div>
        </div>
    </div>
    <div class="flex flex-4 flex-column">
        <div class="profile-container">
            <div class="profile-box">
                <form class="create-event-form" [formGroup]="createEventForm">
                    <div class="input-column px-2 ws-mat-accent-border mb-6 padding-top-m padding-bottom-m padding-right-xl padding-left-xl"
                        id="eventInfo">
                        <div class="margin-bottom-s">
                            <label class="heading">Event details</label>
                            <label for="eventTitle" class=" margin-remove-bottom form-label required"
                                aria-label="Event title label">
                                Upload cover photo
                            </label>
                            <br>
                            <span class="aspect-ratio">Image will be cropped to 16:9 aspect ratio</span>
                            <div class="input-wrapper margin-top-s">
                                <div class="mb-5 image-box display-block">
                                    <mat-card class="text-center"
                                        [ngClass]="imageSrcURL ? 'button-row' : 'button-row-inline'">
                                        <div class="item text-center">
                                            <ng-container *ngIf="!imageSrcURL">
                                                <div class="images">
                                                    <div class="img">
                                                        <img alt="jpg" class="imgicon display-block"
                                                            src="/assets/icons/jpg.svg">
                                                    </div>
                                                    <div class="img">
                                                        <img alt="png" class="imgicon display-block"
                                                            src="/assets/icons/png.svg">
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <ng-container>
                                                <div id="thumbnail" class="deleteIcon" *ngIf="imageSrcURL">
                                                    <a href="javascript:void(0);" (click)="removeSelectedFile()">
                                                        <mat-icon id="btnDelete">close</mat-icon>
                                                    </a>
                                                </div>
                                            </ng-container>
                                            <ng-container>
                                                <input type="file" id="coverPicture" (change)="onFileSelect($event);"
                                                    accept="image/x-png,image/jpeg" />
                                                <img *ngIf="imageSrcURL" id="blah" [src]="imageSrcURL"
                                                    alt="your image" />
                                                <div class="margin-top-m" *ngIf="!imageSrcURL">
                                                    <div><a color="accent" class="browse-link"
                                                            (click)="selectCover()">Browse
                                                            files</a></div>
                                                </div>
                                                <mat-card-content *ngIf="!imageSrcURL"
                                                    class="caption dispaly-block ws-mat-black60-text text-center">
                                                    <div class="margin-top-m supported-files">
                                                        Max file size: 500KB<br>
                                                        Supported file types: <b>jpg, jpeg, png</b>
                                                    </div>
                                                </mat-card-content>
                                            </ng-container>
                                        </div>
                                    </mat-card>
                                    <mat-error [hidden]="false"
                                        aria-label="Event image Error|Explains event image is required " *ngIf="createEventForm?.controls['eventPicture']?.touched && createEventForm?.controls['eventPicture'].errors?.required &&
                                            errorMessages?.length === 0">Event
                                        image is mandatory
                                    </mat-error>
                                    <mat-error [hidden]="false"
                                        aria-label="Event image Error|Explains event image is required "
                                        *ngIf="errorMessages?.length > 0">{{errorMessages}}

                                    </mat-error>
                                </div>
                            </div>
                        </div>
                        <div class="margin-bottom-s">
                            <label for="eventTitle" class=" margin-remove-bottom form-label required"
                                aria-label="Event title label">
                                Event title
                            </label>
                            <mat-form-field appearance="outline" class="margin-top-xs">
                                <input id="eventTitle" matInput #eventTitle formControlName="eventTitle"
                                    placeholder="Type here" aria-label="Event Title input" class="form-input"
                                    (paste)="omit_special_char($event)" (keypress)="omit_special_char($event)"
                                    maxlength="250" />
                                <mat-error [hidden]="false"
                                    aria-label="Event title Error|Explains event title is required "
                                    *ngIf="createEventForm?.controls['eventTitle']?.touched && createEventForm?.controls['eventTitle'].errors?.required">
                                    Event title is mandatory
                                </mat-error>
                                <mat-hint>{{eventTitle.value.length}}/250 characters</mat-hint>
                            </mat-form-field>
                        </div>
                        <div class="margin-bottom-s">
                            <label for="description" class=" margin-remove-bottom form-label required"
                                aria-label="description label">
                                Description
                            </label>
                            <label class="sub_title">Detailed description about the event. It will
                                appear in the event details page</label>
                            <mat-form-field appearance="outline" class="margin-top-xs">
                                <textarea id="description" matInput #description formControlName="description"
                                    placeholder="Type here" aria-label="description input" class="form-input" rows="8"
                                    cols="40" maxlength="1000"></textarea>
                                <mat-error [hidden]="false"
                                    aria-label="description Error|Explains description is required "
                                    *ngIf="createEventForm?.controls['description']?.touched &&
                                                                                    createEventForm?.controls['description'].errors?.required">
                                    Description is mandatory
                                </mat-error>
                                <mat-error [hidden]="false"
                                    aria-label="description Error|Explains description is required " *ngIf="createEventForm?.controls['description']?.touched &&
                                        createEventForm?.controls['description'].errors?.noHtml">
                                    HTML and javascript is not allowed
                                </mat-error>
                                <mat-hint>{{description.value.length}}/1000 characters</mat-hint>
                            </mat-form-field>
                        </div>
                        <div class="margin-bottom-s">
                            <label for="agenda" class=" margin-remove-bottom form-label" aria-label="agenda label">
                                Event agenda
                            </label>
                            <mat-form-field appearance="outline" class="margin-top-xs">
                                <textarea id="agenda" matInput #agenda formControlName="agenda" placeholder="Type here"
                                    aria-label="agenda input" class="form-input" rows="8" cols="40"
                                    maxlength="500"></textarea>
                                <mat-error [hidden]="false"
                                    *ngIf="createEventForm?.controls['agenda']?.touched && createEventForm?.controls['agenda'].errors?.required">
                                    Agenda is mandatory
                                </mat-error>
                                <mat-error [hidden]="false"
                                    *ngIf="createEventForm?.controls['agenda']?.touched && createEventForm?.controls['agenda'].errors?.noHtml">
                                    HTML and javascript is not allowed
                                </mat-error>
                                <mat-hint>{{agenda.value.length}}/500 characters</mat-hint>
                            </mat-form-field>
                        </div>
                        <div class="margin-bottom-s">
                            <label>Event type</label>
                            <mat-form-field appearance="outline" class="custom-width margin-top-xs">
                                <mat-select formControlName="eventType" (selectionChange)="resetDateField()">
                                    <mat-option [value]="type" *ngFor="let type of evntTypesList">{{type}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <!-- <div class="flex custom mt-5" fxLayout="row wrap">
                                <mat-card class="event_container padding-remove" fxLayout="row"
                                    fxLayoutWrap>
                                    <mat-card *ngFor="let type of eventTypes"
                                        class="event_types mb-10"
                                        [ngClass]="type.disabled == false ? 'highlight' : 'dull'">
                                        <mat-card-header>
                                            <mat-card-subtitle class="mat-body-2">
                                                <input type="radio" name="eventType" checked
                                                    [value]="type.title"
                                                    (change)="changeEventType($event)"
                                                    [disabled]="type.disabled">
                                                <label class="event_types">{{ type?.title }}</label>
                                            </mat-card-subtitle>
                                        </mat-card-header>
                                        <mat-card-content class="event_type_desc">
                                            {{ type?.desc }}
                                        </mat-card-content>
                                    </mat-card>
                                </mat-card>
                            </div>
                            <br /><mat-checkbox aria-label="Get Karmayogi badge" id="kb-badge"
                                formControlName="isItKarmayogiTalk" #isItKarmayogiTalk [checked]=""
                                 aria-label="Is it Karmayogi talk">
                                <label >
                                    Is it Karmayogi talk
                                </label>
                            </mat-checkbox> -->
                        </div>
                    </div>
                    <div class="input-column px-2 ws-mat-accent-border mb-6 padding-top-m padding-bottom-m padding-right-xl padding-left-l"
                        id="videoinfo">
                        <label class="heading">Add link</label>
                        <div class="input-wrapper margin-top-s">
                            <label for="conferenceLink" class=" margin-remove-bottom form-label required"
                                aria-label="conferenceLink label">
                                Event link
                            </label>
                            <label class="sub_title">Add a link so people know where to go when your
                                events starts.</label>
                            <mat-form-field appearance="outline" class="margin-top-xs">
                                <input id="conferenceLink" matInput #conferenceLink formControlName="conferenceLink"
                                    placeholder="Type here" aria-label="conferenceLink input" class="form-input"
                                    rows="4" cols="40" maxlength="500" />
                                <mat-error [hidden]="false"
                                    aria-label="conferenceLink Error|Explains conferenceLink is required "
                                    *ngIf="createEventForm?.controls['conferenceLink']?.touched && createEventForm?.controls['conferenceLink'].errors?.required">
                                    Event link is mandatory
                                </mat-error>
                                <mat-error [hidden]="false"
                                    *ngIf="createEventForm?.controls['conferenceLink'].errors?.pattern"
                                    aria-label="conferenceLink Error|conferenceLink fields cannot contain numbers and special characters except">
                                    Please input correct event link URL
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="input-column px-2 ws-mat-accent-border mb-6 padding-top-m padding-bottom-m padding-right-xl padding-left-l"
                        id="datetime">
                        <label class="heading">Date time</label>
                        <div class="input-wrapper margin-top-s">

                            <div class="flex-parent-element">
                                <div class="flex-child-element">
                                    <label for="eventDate" class=" margin-remove-bottom form-label required"
                                        aria-label="Event Date label">
                                        Date
                                    </label>
                                    <ng-container
                                        *ngIf="allowedCurrentDates?.includes(createEventForm.get('eventType')?.value)">
                                        <mat-form-field color="accent" appearance="outline">
                                            <input matInput [matDatepicker]="eventDate" formControlName="eventDate"
                                                [min]="currentDate" [max]="maxDate" [(ngModel)]="todayDate"
                                                (dateChange)="updateDate($event)">
                                            <mat-datepicker-toggle matSuffix [for]="eventDate">
                                            </mat-datepicker-toggle>
                                            <mat-datepicker #eventDate></mat-datepicker>
                                            <mat-error [hidden]="false"
                                                aria-label="eventDate Error|Explains eventDate is required "
                                                *ngIf="createEventForm?.controls['eventDate']?.touched && createEventForm?.controls['eventDate'].errors?.required">
                                                Event Date is mandatory
                                            </mat-error>
                                            <mat-error [hidden]="false"
                                                *ngIf="createEventForm?.controls['eventDate'].errors?.pattern"
                                                aria-label="eventDate Error|eventDate fields cannot contain numbers and special characters except">
                                                Event Date fields cannot contain numbers and special
                                                characters
                                                except '
                                            </mat-error>
                                        </mat-form-field>
                                    </ng-container>
                                    <ng-container
                                        *ngIf="!allowedCurrentDates?.includes(createEventForm.get('eventType')?.value)">
                                        <mat-form-field color="accent" appearance="outline">
                                            <input matInput [matDatepicker]="eventDate" formControlName="eventDate"
                                                [max]="maxDate" [(ngModel)]="todayDate"
                                                (dateChange)="updateDate($event)">
                                            <mat-datepicker-toggle matSuffix [for]="eventDate">
                                            </mat-datepicker-toggle>
                                            <mat-datepicker #eventDate></mat-datepicker>
                                            <mat-error [hidden]="false"
                                                aria-label="eventDate Error|Explains eventDate is required "
                                                *ngIf="createEventForm?.controls['eventDate']?.touched && createEventForm?.controls['eventDate'].errors?.required">
                                                Event Date is mandatory
                                            </mat-error>
                                            <mat-error [hidden]="false"
                                                *ngIf="createEventForm?.controls['eventDate'].errors?.pattern"
                                                aria-label="eventDate Error|eventDate fields cannot contain numbers and special characters except">
                                                Event Date fields cannot contain numbers and special
                                                characters
                                                except '
                                            </mat-error>
                                        </mat-form-field>
                                    </ng-container>
                                </div>
                                <div class="flex-child-element">
                                    <label for="eventTime" class=" margin-remove-bottom form-label required"
                                        aria-label="Event Time label">
                                        When
                                    </label>
                                    <mat-form-field appearance="outline">
                                        <mat-select formControlName="eventTime" #eventTime [(ngModel)]="todayTime">
                                            <mat-option *ngFor="let timeObj of timeArr" [value]="timeObj.value">
                                                {{ timeObj.value }}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error [hidden]="false"
                                            aria-label="eventTime Error|Explains eventTime is required "
                                            *ngIf="createEventForm?.controls['eventTime']?.touched && createEventForm?.controls['eventTime'].errors?.required">
                                            Event Time is mandatory
                                        </mat-error>
                                        <mat-error [hidden]="false"
                                            *ngIf="createEventForm?.controls['eventTime'].errors?.pattern"
                                            aria-label="eventTime Error|eventTime fields cannot contain numbers and special characters except">
                                            Event Time fields cannot contain numbers and special
                                            characters
                                            except '
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="flex-parent-element">
                                <div class="flex-child-element">
                                    <label for="eventDurationHours" class=" margin-remove-bottom form-label required"
                                        aria-label="Event Duration label">
                                        Duration Hours
                                    </label>
                                    <mat-form-field appearance="outline" class="margin-right-l">
                                        <mat-select formControlName="eventDurationHours" #eventDuration>
                                            <mat-option *ngFor="let hourObj of hoursList" [value]="hourObj">
                                                {{hourObj}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error [hidden]="false"
                                            aria-label="eventDurationHours Error|Explains eventDurationHours is required "
                                            *ngIf="createEventForm?.controls['eventDurationHours']?.touched && createEventForm?.controls['eventDurationHours'].errors?.required">
                                            Duration Hours field is mandatory
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div class="flex-child-element">
                                    <label for="eventDurationMinutes" class="margin-remove-bottom form-label required"
                                        aria-label="Event Duration label">
                                        Duration Minutes
                                    </label>
                                    <mat-form-field appearance="outline">
                                        <mat-select formControlName="eventDurationMinutes" #eventDuration>
                                            <mat-option *ngFor="let minObj of minsList" [value]="minObj">
                                                {{minObj}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-error [hidden]="false"
                                            aria-label="eventDurationMinutes Error|Explains eventDurationMinutes is required "
                                            *ngIf="createEventForm?.controls['eventDurationMinutes']?.touched && createEventForm?.controls['eventDurationMinutes'].errors?.required">
                                            Duration Minutes field is mandatory
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- <div>
                                    <label class="mat-subheading-2 margin-0 requried"
                                        >Total
                                        duration <small >(hh:mm)</small>
                                        <span class="required-duration">*</span></label>
                                    <div class="duration-time margin-top-xs">
                                        <div class="duration-d">
                                            <mat-form-field appearance="outline" class="duration-width margin-right-s">
                                                <input #eventDurationHours formControlName="eventDurationHours" matInput
                                                    class="numberInput" type="text" placeholder="00" min="0" max="23"
                                                    step="1" tabindex="3" />
                                            </mat-form-field>
                                            <div class="margin-top-s padding-small">:</div>
                                        </div>
                                        <div class="duration-d">
                                            <mat-form-field appearance="outline"
                                                class="duration-width margin-right-s margin-left-s">
                                                <input #eventDurationMinutes formControlName="eventDurationMinutes"
                                                    matInput class="numberInput" type="text" placeholder="00" min="0"
                                                    max="59" step="1" tabindex="4" />
                                            </mat-form-field>
                                        </div>

                                        <div class="flex flex-col">
                                            <div>
                                                <mat-error
                                                    *ngIf="(createEventForm?.controls['eventDurationHours']?.touched && createEventForm?.controls['eventDurationHours'].errors?.required) ||
                                                                                            (createEventForm?.controls['eventDurationMinutes']?.touched && createEventForm?.controls['eventDurationMinutes'].errors?.required)"
                                                    >Duration
                                                    is mandatory</mat-error>
                                            </div>

                                            <div>

                                                <mat-error
                                                    *ngIf="(createEventForm?.controls['eventDurationHours']?.touched && createEventForm?.controls['eventDurationHours'].errors?.min) ||
                                                    (createEventForm?.controls['eventDurationHours']?.touched && createEventForm?.controls['eventDurationHours'].errors?.max)"
                                                    >Hours
                                                    must
                                                    be
                                                    in 0-23 range</mat-error>
                                            </div>
                                            <div>

                                                <mat-error
                                                    *ngIf="(createEventForm?.controls['eventDurationMinutes']?.touched && createEventForm?.controls['eventDurationMinutes'].errors?.min) ||
                                                                                                        (createEventForm?.controls['eventDurationMinutes']?.touched && createEventForm?.controls['eventDurationMinutes'].errors?.max)"
                                                    >Minutes
                                                    must be in 0-59 range</mat-error>
                                            </div>

                                            <div>

                                                <mat-error
                                                    *ngIf="(createEventForm?.controls['eventDurationHours']?.touched && createEventForm?.controls['eventDurationHours'].errors?.pattern) ||
                                                                                                        (createEventForm?.controls['eventDurationMinutes']?.touched && createEventForm?.controls['eventDurationMinutes'].errors?.pattern)"
                                                    >Hours
                                                    and minutes can only be maximum of 2 digits and without decimal
                                                    point</mat-error>
                                            </div>


                                        </div>

                                    </div>
                                </div> -->
                            </div>
                        </div>
                    </div>
                    <div class="input-column px-2 ws-mat-accent-border mb-3 padding-top-m padding-bottom-m padding-right-xl padding-left-l marging-bottom-l"
                        id="presenter">
                        <label class="heading">Presenters</label>
                        <div class="input-wrapper margin-top-s">
                            <label class="form-label" aria-label="conferenceLink label mb-10 ws-mat-black60-text">
                                Presenters added are displayed in the event details page
                            </label>
                            <div class="flex flex-1 custom button-row-add-user">
                                <button mat-stroked-button color="accent" type="button"
                                    class="mat-accent-border flex-auto-display" (click)="openDialog()">
                                    <span>Add karmayogi user</span>
                                </button>
                            </div>
                            <div class="example-table-container" *ngIf="participantsArr.length > 0">
                                <table class="mat-body-2"><!-- //NOSONAR -->
                                    <tr>
                                        <td>Full name</td>
                                        <td>Email</td>
                                        <td>Type</td>
                                        <td>MDO name</td>
                                    </tr>
                                    <tr *ngFor="let row of participantsArr">
                                        <td>{{ row.firstname || row.name}} </td>
                                        <!-- <td>{{ row.firstname }} {{ row.lastname }}</td> -->
                                        <td>{{ row.email }}</td>
                                        <td>{{ row.type }}</td>
                                        <td>{{ row.mdoName }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="page_title_flex ">
        <span class="required"></span>
        <span class="flex font-bold mr-2    ">Note:</span>
        <span class="flex bold">Event will be visible after 30 minutes in the learner portal.</span>
    </div>

    <div class="page_title_flex">
        <span class="spacer"></span>
        <div class="flex flex-3 custom button-row-inline">
            <div>
                <button mat-stroked-button color="accent" type="button" class="mat-accent-border flex-auto-display"
                    (click)="goToList()">
                    <span>Cancel</span>
                </button>
                <button mat-button class="create-btn btn-success" type="button" (click)="onSubmit()"
                    [disabled]="!createEventForm.valid || disableCreateButton">
                    <span>Submit</span>
                </button>
            </div>
            <div *ngIf="displayLoader" class="mt-5 pr-4 flex items-center justify-center">
                <mat-spinner [diameter]="30"></mat-spinner>
            </div>
        </div>
    </div>
</div>
<div>
  <ws-app-help-center-guide [helpCenterGuide]="helpCenterGuide"></ws-app-help-center-guide>
</div>
<mat-card class="content-upload m-1 mb-5">
  <div class="flex flex-col mb-6">
    <div class="flex gap-1 items-center">
      <span class="header">Manage Course Catalog</span>
    </div>
  </div>
  <mat-card-content>
    <div class="flex flex-col w-full gap-10">
      <div class="flex flex-col gap-4">
        <span class="instruction-text mb-2">Open & follow these instruction</span>
        <span class="instruction-text">1.Please ensure the course catalog file is named correctly and data is
          accurate.</span>
        <span class="instruction-text">2.Download the log report from 'Download Log' for details on the uploaded
          file.</span>
      </div>

      <div class="flex gap-4">
        <div class="flex w-full flex-col gap-1">
          <div>
            <span class="header">Upload Course Catalog</span>
          </div>
          <ng-container *ngIf="!contentFileUploaded; else fileUploaded">

            <div class="flex flex-col file-upload-box justify-center gap-4" wsAuthDragDrop
              (fileDropped)="onDrop($event)" (click)="fileInput.click()">
              <div class="flex flex-col gap-1 items-center justify-center w-full">
                <img class="file-icon" src="/assets/icons/csv.svg" alt="pdf icon">
                <div class="flex flex-col gap-2 items-center">
                  <a class="browse-file">Browse files</a>
                  <span class="or-text">or</span>
                  <span class="drag-file">Drag file to upload</span>
                </div>
                <div class="flex flex-col gap-1 mt-1 items-center">
                  <span class="file-size">Max file size: 100 MB</span>
                  <span class="file-type">Supported file types: .csv, .xlsx</span>
                </div>
              </div>

              <input type="file" style="display: none;" #fileInput accept=".xlsx, .csv"
                (change)="onDrop($event.target.files[0]); fileInput.value = null" />
            </div>
          </ng-container>
          <ng-template #fileUploaded>
            <div class="flex flex-col file-upload-box justify-center gap-4 file-uploaded-box">
              <mat-icon class="removeFile" matTooltip="Remove File" (click)="removeFile()">close</mat-icon>
              <div class="flex items-center justify-center">
                <img src="/assets/icons/samplePdf.svg" alt="file" class="samplePdf">
                <div class="flex flex-column gap-4 pdfDetails">
                  <span class="pdfName">{{fileName}}</span>
                  <span class="documentAttached flex items-center">
                    <mat-icon class="greenTick">check_circle</mat-icon>
                    File attached
                  </span>
                </div>
              </div>
            </div>
          </ng-template>
        </div>

        <div class="flex w-full flex-col gap-1">
          <div>
            <span class="header">Transform Content</span>
          </div>
          <div class="flex flex-col gap-4 transformation-box"
            [ngClass]="{'transformation-required': (!transformationsUpdated && executed)}">
            <form [formGroup]="transforamtionForm">
              <div class="flex flex-col gap-2">
                <ng-container *ngFor="let transFormControl of transFormContentKeysAndControls">
                  <div class="flex gap-4 items-center">
                    <span class="lable">{{transFormControl.lable}}</span>
                    <span class="colun">:</span>
                    <mat-form-field appearance="outline" class="w-full">
                      <mat-select formControlName="{{transFormControl.controlName}}"
                        (selectionChange)="onSelectChange()" [placeholder]=transFormControl.lable>
                        <ng-container *ngFor="let header of availableHeadrsList">
                          <mat-option [value]="header">
                            {{header}}
                          </mat-option>
                        </ng-container>
                        <ng-container *ngIf="transforamtionForm.value[transFormControl.controlName]">
                          <mat-option [value]="transforamtionForm.value[transFormControl.controlName]">
                            {{transforamtionForm.value[transFormControl.controlName]}}
                          </mat-option>
                        </ng-container>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </ng-container>

                <div class="flex w-full justify-end mt-4">
                  <button mat-button class="save-properties" (click)="upDateTransforamtionDetails()">
                    {{providerDetalsBeforUpdate!.trasformContentJson ? 'Update Transform Content' : 'Save
                    Transform Content'}}</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="flex w-full justify-center">
        <button mat-button class="save-properties" (click)="uploadFile()">
          Execute</button>
      </div>
    </div>
  </mat-card-content>
</mat-card>

<ng-container *ngIf="!delayTabLoad">
  <mat-tab-group class="">
    <mat-tab label="Upload Status">
      <div class="w-full mt-3 flex flex-col">
        <ng-container *ngIf="!showUploadedStatusLoader; else showLoader">
          <div>
            <ws-app-courses-table [tableData]="contentTableData" [data]="uploadedContentList"
              [menuItems]="contenetMenuItems" (actionsClick)="contentEvents($event)"></ws-app-courses-table>
          </div>
        </ng-container>
      </div>
    </mat-tab>
    <mat-tab label="Not Published Courses">
      <ng-container *ngIf="!showUploadedStatusLoader; else showLoader">
        <div class="w-full mt-4 flex flex-col gap-1">
          <ws-app-courses-table [tableData]="unPublishedCoursesTableData" [data]="unPublishedCoursesList"
            [menuItems]="unpublishedCoursesMenuItems" [paginationDetails]="unPublishedCoursesTablePaginationDetails"
            (searchKey)="searchCourses(false, $event)" (pageChange)="pageChange($event, 'notPublished')"
            (actionsClick)="contentEvents($event)"></ws-app-courses-table>
        </div>
      </ng-container>
    </mat-tab>
    <mat-tab label="Published Courses">
      <ng-container *ngIf="!showPublishedCoursesLoader; else showLoader">
        <div class="w-full mt-4 flex flex-col gap-1">
          <ws-app-courses-table [tableData]="publishedCoursesTableData" [data]="publishedCoursesList"
            [paginationDetails]="publishedCoursesTablePaginationDetails" (searchKey)="searchCourses(true, $event)"
            (pageChange)="pageChange($event, 'published')"></ws-app-courses-table>
        </div>
      </ng-container>
    </mat-tab>
  </mat-tab-group>
</ng-container>

<ng-template #showLoader>
  <div class="w-full flex items-center justify-center dataLoader">
    <mat-spinner [diameter]="50" class="dataSpinner"></mat-spinner>
  </div>
</ng-template>